# Repository Guidelines

クレデンシャルは絶対に入れないでください。

## プロジェクト構成とモジュール整理
- ルート直下に各ドメインごとの`.zsh`ファイルを配置しています（例：`awscli-alias.zsh`、`git-alias.zsh`、`terraform-alias.zsh`）。用途別に必ずファイルを分けることで、読み込み順序と依存関係を明確に保ちます。  
- `README.md`は利用者ドキュメントと索引を兼ねているため、新規エイリアスを追加したら対応する表や説明も同時に更新してください。セクションを追加する際は既存の見出しレベルに合わせ、表形式を維持します。  
- 共通ユーティリティや将来の共有関数が必要な場合は`common-alias.zsh`のようなファイルを新設し、既存ファイルからの再定義を避けます。  
- 機能追加の際は関連ドメインのファイルに限定して編集し、混在を避けることで読み手が素早く目的のエイリアスを特定できるようにします。不要になったエイリアスはコメントアウトでの温存ではなく削除し、Git履歴で追跡できるようにしましょう。  
- ファイル読み込み順が想定どおりか確認したい場合は`for f in ~/.zsh/aliases/*.zsh; do echo $f; done`で順序を出力し、依存関係の破綻がないかチェックします。

## ビルド・テスト・開発コマンド
- `source ~/.zprofile`：このリポジトリを読み込む設定を再適用します。編集後は一度これを実行してエイリアスが即時反映されるか確認してください。複数端末を使う場合もそれぞれで同じ操作が必要です。  
- `zsh -n git-alias.zsh`：構文チェック用のコマンドです。編集したファイル名に置き換えて実行し、シンタックスエラーがないことを確認します。複数ファイル編集時は`for f in *.zsh; do zsh -n "$f"; done`などの一括チェックを推奨します。  
- `shellcheck awscli-alias.zsh`：ShellCheckがインストールされている場合は静的解析で潜在的な問題を検出できます（推奨）。エラー時には指摘コードをコミットメッセージやPRで共有するとレビューがスムーズです。  
- `grep -R "alias ga" .`のように`rg`や`grep`で重複確認を行い、既存エイリアスとの競合を事前に防ぎます。重複を検出した場合は`README.md`の該当行まで確認し、用途を統合するか命名を見直してください。  
- 追加したエイリアスを即時に試す際は`alias | grep tf`などで登録状況を確認し、`type <alias>`で本体を表示する手順もセットで覚えておきます。  
- `gh pr status`や`gh pr view`を活用すると、GitHub CLI関連エイリアスの動作回帰を素早くチェックできます。

## コーディングスタイルと命名規則
- インデントはタブではなくスペース2個を基本とし、条件分岐やループでは明示的にブロックを揃えます。長いコマンドはバックスラッシュで改行し整形してください。  
- エイリアス名はツール頭字語＋動詞（例：`ghprm`はGitHub PR Merge）とし、関数は短い動詞句で英小文字＋動詞を採用します（例：`chprof`）。一目で用途がわからない場合はREADME側の説明で補います。  
- 既存の慣例に合わせ、説明コメントは英語または簡潔な日本語で1行にまとめます。スクリプト外部に依存する変数はコメントで宣言例を添えると利用者が迷いません。  
- 破壊的操作を含むエイリアスでは`# CAUTION:`タグをコメントに付け、レビュー時に意図が伝わるようにします。複数行コマンドをラップする場合は関数化し、エラー時の戻り値も意識してください。  
- ファイル末尾には改行を残し、UTF-8で保存します。グローバル設定の違いによる文字化けを避けるため、非ASCII文字は説明コメントのみに限定します。

## テストガイドライン
- 影響範囲が広い変更では`zsh -n`と`shellcheck`を全ファイルに対して実行するか、最低限更新したファイルのみ検証してください。CIは存在しないため、人力のチェックリストを維持することが重要です。  
- 可能であれば一時的に新しいシェルセッションを開き、`ga`などの代表的なエイリアスが期待どおりに動作するか簡易E2Eテストを行います。不要な副作用（余計な出力や環境変数書き換え）がないかも合わせて確認します。  
- 別環境（例：macOSとWSL）のどちらでも動作するかを意識し、GNUコマンド固有オプションの使用は慎重に評価してください。  
- テスト用ファイル名は`*_test.sh`のような命名にはせず、既存ファイルを直接評価します。動作検証のメモはPRテンプレートまたはPR本文に記録しましょう。  
- バグ修正の場合は再現手順→修正内容→再テスト結果の順に記録し、レビュワーが再現可能な最低限のステップを残してください。

## コミットとプルリクエストの指針
- 既存履歴に倣い、コミットメッセージは`[add] 説明 (#issue)`のように角括弧でカテゴリを明示し、関連Issue番号がある場合は末尾に追記します。カテゴリとしては`[fix]`や`[chore]`も許容されますが、粒度は揃えてください。  
- 1コミット1テーマを徹底し、異なるツールのエイリアス変更は分割してください。レビュー単位を小さく保つことでリグレッションを防げます。  
- プルリクエストでは概要・影響範囲・確認手順を簡潔に記載し、スクリーンショットよりも実行ログやコマンド例を添付する方が有用です。レビュワーがローカルで再現できる手順を3行以内でまとめると親切です。  
- Slack Webhookなど機密情報は環境変数で読み込む設計なので、機密値をリポジトリに含めない方針を明記してください。レビューコメントで値を貼り付けないこともルール化します。  
- Draftの段階では作業中の課題や未解決の質問を箇条書きし、Ready for Reviewに切り替える際にテスト結果を追記しましょう。リリースノートに反映すべき内容がある場合は同時に記録します。

## セキュリティと設定メモ
- `SLACK_WEBHOOK_URL`などのシークレットは必ずローカル環境でエクスポートし、サンプル値は共有しても実値は記録しません。ドキュメントではプレースホルダ（例：`export SLACK_WEBHOOK_URL=<your-url>`）を用います。  
- エイリアス内で外部コマンドをラップする場合、破壊的操作（`rm`、`terraform destroy`など）は十分な引数チェックや確認メッセージを検討してください。新規作成時は安全なデフォルト（例：`rm`を`trash-put`に置き換える）を維持します。  
- パスをハードコードする際は`$HOME`等の環境変数を用いて他環境での再利用性を担保します。絶対パスが避けられない場合はmacOS/Linuxで差異が出ないか確認します。  
- チーム共有用に`example.zprofile`といったテンプレートファイルを追加する場合、実運用の秘密値はダミー値で置き換え、手順をREADMEと同期させることを忘れないでください。  
- 監査対応として、危険度の高いエイリアスを追加した際はPR説明に監査メモを残し、Slack通知等のフローを別途整備することを推奨します。  
- ランタイム環境の差異を吸収するため、クラウドCLIの資格情報は常に公式クライアントのプロファイル機能に委譲し、エイリアスで平文パスワードを扱わないでください。

## エージェント作業フロー
- 新規作業時は`git status`で既存変更を把握し、競合しそうなブランチがないか確認します。ブランチ名は`feature/<topic>`や`hotfix/<issue>`のように短く要点を示してください。  
- タスク受領→要件整理→対象ファイル特定→ローカル検証→ドキュメント更新→PR作成の順序を守るとレビューが円滑です。READMEとAGENTSの両方に影響する場合、ドキュメント整合性を最終チェックとして追加します。  
- PR提出後はレビュー指摘を即時反映し、必要なら`git commit --amend`や`git rebase -i`で履歴を整えます。最終マージ担当が別の場合は、マージ戦略（squash/merge）をPRコメントで共有してください。  
- エージェント作業の終了時には`gh pr create`等の自動化エイリアスを一度実行して挙動を点検し、レビュー待ちのタスクをSlackやIssueで共有してからセッションを閉じてください。
